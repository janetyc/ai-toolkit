(this.webpackJsonpaitoolkit=this.webpackJsonpaitoolkit||[]).push([[0],{233:function(e,t,a){e.exports=a(445)},239:function(e,t,a){},433:function(e,t,a){},445:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(55),o=a.n(c),i=(a(238),a(45)),u=a(49),l=a(460),s=a(459),m=a(34),f=(a(239),a(9)),p=a.n(f),d=a(8),b=a(22),h=a(453),g=a(457),j=a(32),E=a.n(j);function y(){return(y=Object(b.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.get("/api/get_all_projects");case 2:return t=e.sent,e.abrupt("return",t.data.all_projects);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var O=function(){var e=Object(n.useState)([]),t=Object(d.a)(e,2),a=t[0],c=t[1];return Object(n.useEffect)((function(){(function(){return y.apply(this,arguments)})().then(c)}),[]),r.a.createElement(h.a,null,r.a.createElement(g.a.Group,{style:{marginTop:"2em"},itemsPerRow:4},a.map((function(e,t){return r.a.createElement(g.a,{key:t,href:"/#/project/"+e.id},r.a.createElement(g.a.Content,null,r.a.createElement(g.a.Header,null,"Project: ",e.title),r.a.createElement(g.a.Description,null,e.description)))}))))},v=a(461),k=a(21),w=a(221),S=a(206),x=a.n(S),_=a(70),T=function(e){var t=e.setImages,a=Object(n.useCallback)((function(e){e.forEach((function(e){var a=new FileReader;a.onload=function(e){console.log("upload image"),t((function(t){return[].concat(Object(k.a)(t),[{id:x()(),src:e.target.result}])}))},a.readAsDataURL(e)}))}),[t]),c=Object(w.a)({onDrop:a}),o=c.getRootProps,i=c.getInputProps,u=c.isDragActive;return r.a.createElement("div",Object.assign({className:"ui center aligned secondary segment"},o()),r.a.createElement(_.a,{name:"cloud upload",size:"big"}),r.a.createElement("input",i()),u?r.a.createElement("p",null,"Drop the files here ..."):r.a.createElement("p",null,"Drag 'n' drop some files here, or click to select files"))},L=a(458),R=a(454),P={display:"inline",width:100,height:100,padding:"3px"};function C(){return(C=Object(b.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.post("/api/add_images",t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var D=function(e){var t=e.statusCallback,a=e.projectId,c=Object(n.useState)([]),o=Object(d.a)(c,2),i=o[0],u=o[1],l=Object(n.useState)(!1),m=Object(d.a)(l,2),f=m[0],p=m[1];return r.a.createElement("div",null,f&&r.a.createElement(L.a,{active:!0,inverted:!0},r.a.createElement(R.a,{size:"medium"},"Uploading")),r.a.createElement(T,{setImages:u}),r.a.createElement("div",null,i.map((function(e){return r.a.createElement("img",{key:e.id,src:e.src,style:P})}))),i.length>0&&r.a.createElement(s.a,{color:"teal",fluid:!0,size:"small",onClick:function(){p(!0);var e={};i.map((function(t){e[t.id]=t.src})),function(e){return C.apply(this,arguments)}({project_id:a,data:e}).then((function(e){e.success&&(p(!1),u([]),t(!0))}))}},"Submit"))},A=a(222),I=function(e){var t=e.imageList;return r.a.createElement(h.a,null,r.a.createElement(g.a.Group,{itemsPerRow:5},t.map((function(e,t){return r.a.createElement(g.a,{key:e.key},r.a.createElement(g.a.Content,null,r.a.createElement(A.a,{src:e.image_url})),r.a.createElement(g.a.Content,{extra:!0},r.a.createElement(s.a,{attached:"bottom",as:i.b,to:"/annotateObjectStory/"+e.id},"Tell a Story")))}))))};function N(e){return F.apply(this,arguments)}function F(){return(F=Object(b.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.post("/api/get_project_by_id",{project_id:t});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var z=function(e){var t=e.match,a=Object(n.useState)({}),c=Object(d.a)(a,2),o=c[0],u=c[1],l=Object(n.useState)([]),m=Object(d.a)(l,2),f=m[0],p=m[1],b=t.params.pid;return Object(n.useEffect)((function(){N(b).then((function(e){u(e.data),p(e.image_data)})),console.log("fetch")}),[]),r.a.createElement(h.a,null,r.a.createElement("div",{style:{marginTop:"2em"}},r.a.createElement(v.a,{as:"h2"},"Project: ",o.title,0!==f.length&&r.a.createElement(s.a,{style:{marginLeft:"7px"},color:"teal",as:i.b,to:"/annotate/"+b},"Start to Annotate")),r.a.createElement("p",null,o.description)),r.a.createElement("div",{style:{marginTop:"2em"}},r.a.createElement(D,{statusCallback:function(e){N(b).then((function(e){u(e.data),p(e.image_data)})),console.log("upload fetch")},projectId:b})),r.a.createElement("div",{style:{marginTop:"3em"}},r.a.createElement(I,{imageList:f})))},B=a(77),M=a(462),q=a(455),W=a(463),X=a(105);function Y(){return(Y=Object(b.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.post("/api/add_project",t);case 2:a=e.sent,console.log(a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=function(){var e=Object(n.useState)(!1),t=Object(d.a)(e,2),a=t[0],c=t[1],o=Object(B.b)(),i=o.register,l=o.errors,m=o.handleSubmit;return r.a.createElement(h.a,null,a&&r.a.createElement(u.a,{to:"/projects"}),r.a.createElement(M.a,{textAlign:"center",style:{height:"80vh"},verticalAlign:"middle"},r.a.createElement(M.a.Column,{style:{maxWidth:450}},r.a.createElement(q.a,{size:"large",onSubmit:m((function(e,t){(function(e){return Y.apply(this,arguments)})(e).then((function(){c(!0),t.target.reset()}))}))},r.a.createElement(W.a,{stacked:!0},r.a.createElement(q.a.Field,null,r.a.createElement("input",{type:"hidden",name:"created_user",value:"web_user",ref:i}),r.a.createElement("input",{placeholder:"Project title",name:"title",ref:i({required:!0})}),l.title&&r.a.createElement(X.a,{pointing:!0,prompt:!0},"Project title is required")),r.a.createElement(q.a.Field,null,r.a.createElement("input",{placeholder:"Description",name:"description",ref:i({required:!0})}),l.description&&r.a.createElement(X.a,{pointing:!0,prompt:!0},"Project description is required")),r.a.createElement(s.a,{color:"teal",fluid:!0,size:"large"},"Add Project"))))))},G=a(69),H=a(23),V=function(e){var t=e.x,a=e.y,n=e.width,c=e.height,o=e.stroke,i=e.name;return r.a.createElement(H.Rect,{x:t,y:a,width:n,height:c,scaleX:1,scaleY:1,stroke:o,strokeWidth:2,name:i})},J=function(e){var t=e.x,a=e.y,c=e.width,o=e.height,i=e.name,u=e.stroke,l=e.onTransform,s=e.onEnter,m=e.onLeave,f=Object(n.useRef)();Object(n.useEffect)((function(){f.current.getLayer().batchDraw()}),[]);return r.a.createElement(H.Rect,{ref:f,x:t,y:a,width:c,height:o,scaleX:1,scaleY:1,stroke:u,strokeWidth:3,name:i,strokeScaleEnabled:!1,draggable:!0,onDragEnd:function(e){var t=e.target;l({x:t.x(),y:t.y()})},onTransformEnd:function(e){var t=e.target;t.setAttrs({width:t.width()*t.scaleX(),height:t.height()*t.scaleY(),scaleX:1,scaleY:1}),l({width:t.width(),height:t.height(),scaleX:t.scaleX(),scaleY:t.scaleY()})},onMouseEnter:function(e){var t=e.target;t.stroke("#8AE1FF"),t.getStage().container().style.cursor="move",f.current.getLayer().draw(),s(t.name())},onMouseLeave:function(e){var t=e.target;t.stroke("#2982F9"),t.getStage().container().style.cursor="crosshair",f.current.getLayer().draw(),m(t.name())}})};var $=function(e){var t=e.selectedShapeName,a=Object(n.useRef)();return Object(n.useEffect)((function(){var e=a.current.getStage().findOne(".".concat(t));e!==a.current.node()&&(e?a.current.attachTo(e):a.current.detach(),a.current.getLayer().batchDraw())}),[t]),r.a.createElement(H.Transformer,{ref:a,ignoreStroke:!0,rotateEnabled:!1})},K=a(78),Q=a.n(K);a(219);function Z(){return(Z=Object(b.a)(p.a.mark((function e(t,a){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.post("/api/get_predictions_by_image_url",{image_url:t,image_key:a});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(){return(ee=Object(b.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.post("/api/get_project_by_id",{project_id:t});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var te=function(e){var t=e.match,a=Object(n.useState)({}),c=Object(d.a)(a,2),o=(c[0],c[1]),i=Object(n.useState)([]),u=Object(d.a)(i,2),l=u[0],m=u[1],f=Object(n.useState)([]),p=Object(d.a)(f,2),b=p[0],g=p[1],j=Object(n.useState)(!1),E=Object(d.a)(j,2),y=E[0],O=E[1],v=Object(n.useState)(!1),w=Object(d.a)(v,2),S=w[0],x=w[1],_=Object(n.useState)(0),T=Object(d.a)(_,2),L=T[0],R=T[1],P=Object(n.useState)({w:0,h:0}),C=Object(d.a)(P,2),D=C[0],A=C[1],I=Object(n.useState)(0),N=Object(d.a)(I,2),F=N[0],z=N[1],B=Object(n.useState)([]),M=Object(d.a)(B,2),q=M[0],W=M[1],X=Object(n.useState)(0),Y=Object(d.a)(X,2),U=Y[0],K=Y[1],te=Object(n.useRef)([]),ae=Object(n.useState)(""),ne=Object(d.a)(ae,2),re=ne[0],ce=ne[1],oe=Object(n.useState)(!1),ie=Object(d.a)(oe,2),ue=ie[0],le=ie[1],se=Object(n.useRef)([]),me=t.params.pid;function fe(e,t){x(!0),function(e,t){return Z.apply(this,arguments)}(e,t).then((function(e){if(e.success){g(e.data.predictions),x(!1);var t=e.data.image_size;A({w:t[0],h:t[1]})}}))}var pe=function(e){if("Stage"===e.target.getType())return le(!0),void ce("");if(!("Transformer"===e.target.getParent().className)){var t=e.target.name(),a=q.find((function(e){return e.name===t}));ce(a?t:"")}},de=function(){le(!1)};return Object(n.useEffect)((function(){(function(e){return ee.apply(this,arguments)})(me).then((function(e){o(e.data),se.current=[],e.image_data.map((function(e,t){m((function(t){return[].concat(Object(k.a)(t),[{id:e.id,key:e.key,image_url:e.image_url}])})),se.current[t]=Object(n.createRef)()})),O(!0)}))}),[]),r.a.createElement(h.a,null,r.a.createElement("div",null,y&&l.map((function(e,t){return r.a.createElement("img",{key:t,style:{display:"none"},src:e.image_url,ref:se.current[t],onLoad:function(){z(F+1)}})}))),r.a.createElement("div",null,y&&l.map((function(e,t){return r.a.createElement(s.a,{key:t,circular:!0,size:"tiny",onClick:function(){return function(e){R(e),g([]),W([])}(t)},content:t})}))),y&&F==l.length&&r.a.createElement("div",null,r.a.createElement("div",{style:{float:"left",display:"block"}},r.a.createElement(H.Stage,{style:{float:"left"},width:se.current[L].current.width,height:se.current[L].current.height,onMouseDown:pe,onTouchStart:pe,onMouseUp:ue&&de,onTouchEnd:ue&&de},r.a.createElement(H.Layer,null,r.a.createElement(H.Image,{image:se.current[L].current})),r.a.createElement(H.Layer,null,!S&&b.map((function(e,t){return r.a.createElement(H.Group,{key:t},r.a.createElement(V,{x:e.box[1]*D.w,y:e.box[0]*D.h,width:(e.box[3]-e.box[1])*D.w,height:(e.box[2]-e.box[0])*D.h,stroke:"#33d6ff",strokeWidth:2,name:e.label+"-"+t}),r.a.createElement(H.Text,{x:e.box[1]*D.w,y:e.box[0]*D.h,fill:"#ccf5ff",fontSize:20,text:e.label}))}))),r.a.createElement(H.Layer,null,q.map((function(e,t){return r.a.createElement(J,Object.assign({ref:te.current[t].current,sclassName:"rect",key:e.key},e,{onTransform:function(e){!function(e,t){q[e]=Object(G.a)({},q[e],{},t),W((function(e){return Object(k.a)(e)}))}(t,e)}}))})),r.a.createElement($,{selectedShapeName:re})))),r.a.createElement("div",{style:{float:"left",marginLeft:"10px",display:"block"}},r.a.createElement(s.a,{onClick:function(e){e.preventDefault(),fe(l[L].image_url,l[L].key)}},"Predict"),!S&&b.map((function(e,t){return r.a.createElement("div",{key:t},e.label)}))),r.a.createElement("div",{style:{float:"left",marginLeft:"10px",display:"block"}},r.a.createElement(s.a,{onClick:function(e){e.preventDefault(),te.current[U]=Object(n.createRef)(),W((function(e){return[].concat(Object(k.a)(e),[{x:10,y:10,width:100,height:100,name:"rect".concat(U+1),stroke:"#cc0000",key:Q.a.generate(),ref:te.current[U].current}])})),K(U+1)}},"Add"))))};a(433);function ae(){return(ae=Object(b.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.post("/api/add_objectstory",t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(){return(ne=Object(b.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.post("/api/get_image_by_id",{image_id:t});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(){return(re=Object(b.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.post("/api/get_stories_by_image_id",{image_id:t});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ce=function(e){var t=e.match,a=Object(n.useState)({}),c=Object(d.a)(a,2),o=c[0],i=c[1],u=Object(n.useState)(!1),l=Object(d.a)(u,2),m=l[0],f=l[1],p=Object(n.useState)(!1),b=Object(d.a)(p,2),g=(b[0],b[1]),j=Object(n.useState)(!1),E=Object(d.a)(j,2),y=E[0],O=E[1],w=Object(n.useRef)(),S=Object(n.useState)([]),x=Object(d.a)(S,2),_=x[0],T=x[1],L=Object(n.useState)(0),R=Object(d.a)(L,2),P=(R[0],R[1],Object(n.useState)(!1)),C=Object(d.a)(P,2),D=(C[0],C[1]),A=Object(n.useState)([]),I=Object(d.a)(A,2),N=I[0],F=I[1],z=Object(n.useState)(0),W=Object(d.a)(z,2),Y=W[0],U=W[1],V=Object(n.useRef)([]),K=Object(n.useState)(""),Z=Object(d.a)(K,2),ee=Z[0],te=Z[1],ce=Object(n.useState)(""),oe=Object(d.a)(ce,2),ie=oe[0],ue=oe[1],le=Object(n.useState)(!1),se=Object(d.a)(le,2),me=se[0],fe=se[1],pe=t.params.imgid,de=Object(n.useState)(""),be=Object(d.a)(de,2),he=be[0],ge=(be[1],Object(B.b)({mode:"onBlur",defaultValue:{story:"",object:[]}})),je=ge.control,Ee=ge.register,ye=ge.errors,Oe=ge.formState,ve=ge.handleSubmit,ke=Object(B.a)({control:je,name:"object"}),we=ke.append,Se=ke.remove,xe=function(e){if("Stage"===e.target.getType())return fe(!0),void te("");if(!("Transformer"===e.target.getParent().className)){var t=e.target.name(),a=N.find((function(e){return e.name===t}));te(a?t:"")}},_e=function(){fe(!1)};return Object(n.useEffect)((function(){(function(e){return ne.apply(this,arguments)})(pe).then((function(e){i(e.data),f(!0)})),console.log("fetch image url")}),[]),Object(n.useEffect)((function(){(function(e){return re.apply(this,arguments)})(pe).then((function(e){T(e.data),console.log(e.data),g(!0)})),console.log("fetch story data")}),[]),r.a.createElement(h.a,null,m&&r.a.createElement(M.a,{celled:!0},r.a.createElement("img",{style:{display:"none"},src:o.image_url,ref:w,onLoad:function(){O(!0)}}),r.a.createElement(M.a.Column,{width:12},y&&r.a.createElement(H.Stage,{width:800,height:w.current.height*(800/w.current.width),onMouseDown:xe,onTouchStart:xe,onMouseUp:me&&_e,onTouchEnd:me&&_e},r.a.createElement(H.Layer,null,r.a.createElement(H.Image,{image:w.current,width:800,height:w.current.height*(800/w.current.width)})),r.a.createElement(H.Layer,null,_.map((function(e,t){return e.object_list.map((function(e,t){return r.a.createElement(H.Rect,{key:Q.a.generate(),x:800*e.x,y:e.y*w.current.height*(800/w.current.width),width:800*e.w,height:e.h*w.current.height*(800/w.current.width),scaleX:1,scaleY:1,stroke:"#ff3333",strokeWidth:2})}))}))),r.a.createElement(H.Layer,null,N.map((function(e,t){return r.a.createElement(J,Object.assign({sclassName:"rect",key:e.key},e,{onTransform:function(e){!function(e,t){N[e]=Object(G.a)({},N[e],{},t),F((function(e){return Object(k.a)(e)}))}(t,e)},onEnter:function(e){ue(e)},onLeave:function(e){ue("")}}))})),r.a.createElement($,{selectedShapeName:ee})))),r.a.createElement(M.a.Column,{width:4},r.a.createElement(q.a,{onSubmit:ve((function(e,t){var a=[],n=w.current.height*(800/w.current.width);e.object.map((function(e,t){a.push({label:e.name,x:N[t].x/800,y:N[t].y/n,w:N[t].width/800,h:N[t].height/n})})),function(e){return ae.apply(this,arguments)}({created_user:he,image_id:pe,story:e.story,object_list:a}).then((function(){D(!0),t.target.reset(),F([])}))}))},r.a.createElement(M.a.Row,null,r.a.createElement(v.a,{as:"h5",block:!0},"Step 1: Tell a story"),r.a.createElement("textarea",{placeholder:"Tell us a story about this image",style:{minHeight:100},name:"story",ref:Ee({required:!0})}),ye.story&&r.a.createElement(X.a,{pointing:!0,prompt:!0},"Story is required")),r.a.createElement(M.a.Row,{style:{marginTop:"2em"}},r.a.createElement(v.a,{as:"h5",block:!0},"Step 2: Identify key objects to define your story"),r.a.createElement(s.a,{fluid:!0,color:"blue",onClick:function(e){e.preventDefault(),V.current[Y]=Object(n.createRef)();var t=Q.a.generate();F((function(e){return[].concat(Object(k.a)(e),[{x:10,y:10,width:100,height:100,key:t,name:"rect".concat(t),stroke:"#2982F9",lable:"none"}])})),we({name:t}),U(Y+1)},style:{marginBottom:"6px"}},"Add An Object"),N.map((function(e,t){return r.a.createElement("div",{key:e.key,style:{marginBottom:"2px"},className:"".concat(ie==e.name?"hoveredBox":""),onMouseEnter:function(){!function(e,t){t.stroke="#8AE1FF",N[e]=Object(G.a)({},N[e],{},t),F((function(e){return Object(k.a)(e)})),ue(t.name)}(t,e)},onMouseLeave:function(){!function(e,t){t.stroke="#2982F9",N[e]=Object(G.a)({},N[e],{},t),F((function(e){return Object(k.a)(e)})),ue("")}(t,e)}},r.a.createElement("div",{className:"ui icon input",style:{width:"100%"}},r.a.createElement("input",{type:"text",placeholder:"object "+(t+1),name:"object[".concat(t,"].name"),ref:Ee({required:!0})}),r.a.createElement("i",{"aria-hidden":"true",className:"remove circular inverted link icon",onClick:function(){return e=t,N.splice(e,1),F((function(e){return Object(k.a)(e)})),U(Y-1),void Se(e);var e}})))}))),0!==N.length&&r.a.createElement(M.a.Row,{style:{marginTop:"5em"}},Oe.isValid&&r.a.createElement(s.a,{fluid:!0,color:"teal",style:{marginBottom:"6px"}},"Submit this story!"),!Oe.isValid&&r.a.createElement(s.a,{disabled:!0,fluid:!0,color:"teal",style:{marginBottom:"6px"}},"Submit this story!"))))))},oe=Object(m.a)(),ie=r.a.createElement(i.a,{history:oe},r.a.createElement(l.a,null,r.a.createElement(l.a.Item,null,r.a.createElement(i.b,{to:"/"},"Home")),r.a.createElement(l.a.Item,{position:"right"},r.a.createElement(s.a,{color:"teal",as:i.b,to:"/addProject"},"Add Project"))),r.a.createElement(u.d,null,r.a.createElement(u.b,{exact:!0,path:"/",component:O}),r.a.createElement(u.b,{path:"/projects",component:O}),r.a.createElement(u.b,{path:"/project/:pid",component:z}),r.a.createElement(u.b,{path:"/annotate/:pid",component:te}),r.a.createElement(u.b,{path:"/addProject",component:U}),r.a.createElement(u.b,{path:"/annotateObjectStory/:imgid",component:ce})));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement("div",null,ie),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[233,1,2]]]);
//# sourceMappingURL=main.284e9ec3.chunk.js.map