(this.webpackJsonpaitoolkit=this.webpackJsonpaitoolkit||[]).push([[0],{233:function(e,t,a){e.exports=a(444)},239:function(e,t,a){},444:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(54),i=a.n(c),o=(a(238),a(56)),l=a(47),u=a(459),s=a(458),m=a(33),p=(a(239),a(16)),d=a.n(p),f=a(20),h=a(21),b=a(452),g=a(456),E=a(38),j=a.n(E);function y(){return(y=Object(h.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.a.get("/api/get_all_projects");case 2:return t=e.sent,e.abrupt("return",t.data.all_projects);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var v=function(){var e=Object(n.useState)([]),t=Object(f.a)(e,2),a=t[0],c=t[1];return Object(n.useEffect)((function(){(function(){return y.apply(this,arguments)})().then(c)}),[]),r.a.createElement(b.a,null,r.a.createElement(g.a.Group,{style:{marginTop:"2em"},itemsPerRow:4},a.map((function(e,t){return r.a.createElement(g.a,{key:t,href:"/#/project/"+e.id},r.a.createElement(g.a.Content,null,r.a.createElement(g.a.Header,null,"Project: ",e.title),r.a.createElement(g.a.Description,null,e.description)))}))))},O=a(461),k=a(22),w=a(221),x=a(203),S=a.n(x),_=a(69),L=function(e){var t=e.setImages,a=Object(n.useCallback)((function(e){e.forEach((function(e){var a=new FileReader;a.onload=function(e){console.log("upload image"),t((function(t){return[].concat(Object(k.a)(t),[{id:S()(),src:e.target.result}])}))},a.readAsDataURL(e)}))}),[t]),c=Object(w.a)({onDrop:a}),i=c.getRootProps,o=c.getInputProps,l=c.isDragActive;return r.a.createElement("div",Object.assign({className:"ui center aligned secondary segment"},i()),r.a.createElement(_.a,{name:"cloud upload",size:"big"}),r.a.createElement("input",o()),l?r.a.createElement("p",null,"Drop the files here ..."):r.a.createElement("p",null,"Drag 'n' drop some files here, or click to select files"))},P=a(457),T=a(453),D={display:"inline",width:100,height:100,padding:"3px"};function R(){return(R=Object(h.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.a.post("/api/add_images",t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C=function(e){var t=e.statusCallback,a=e.projectId,c=Object(n.useState)([]),i=Object(f.a)(c,2),o=i[0],l=i[1],u=Object(n.useState)(!1),m=Object(f.a)(u,2),p=m[0],d=m[1];return r.a.createElement("div",null,p&&r.a.createElement(P.a,{active:!0,inverted:!0},r.a.createElement(T.a,{size:"medium"},"Uploading")),r.a.createElement(L,{setImages:l}),r.a.createElement("div",null,o.map((function(e){return r.a.createElement("img",{key:e.id,src:e.src,style:D})}))),o.length>0&&r.a.createElement(s.a,{color:"teal",fluid:!0,size:"small",onClick:function(){d(!0);var e={};o.map((function(t){e[t.id]=t.src})),function(e){return R.apply(this,arguments)}({project_id:a,data:e}).then((function(e){e.success&&(d(!1),l([]),t(!0))}))}},"Submit"))},A=a(460),I=a(222),z=function(e){var t=e.imageList;return r.a.createElement(b.a,null,r.a.createElement(A.a,null,r.a.createElement(A.a.Row,{columns:5},t.map((function(e,t){return r.a.createElement(A.a.Column,{key:e.key},r.a.createElement(I.a,{src:e.image_url}))})))))};function W(e){return X.apply(this,arguments)}function X(){return(X=Object(h.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.a.post("/api/get_project_by_id",{project_id:t});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Y=function(e){var t=e.match,a=Object(n.useState)({}),c=Object(f.a)(a,2),i=c[0],l=c[1],u=Object(n.useState)([]),m=Object(f.a)(u,2),p=m[0],d=m[1],h=t.params.pid;return Object(n.useEffect)((function(){W(h).then((function(e){l(e.data),d(e.image_data)})),console.log("fetch")}),[]),r.a.createElement(b.a,null,r.a.createElement("div",{style:{marginTop:"2em"}},r.a.createElement(O.a,{as:"h2"},"Project: ",i.title," ",r.a.createElement(s.a,{color:"teal",as:o.b,to:"/annotate/"+h},"Start to Annotate")),r.a.createElement("p",null,i.description)),r.a.createElement("div",{style:{marginTop:"2em"}},r.a.createElement(C,{statusCallback:function(e){W(h).then((function(e){l(e.data),d(e.image_data)})),console.log("upload fetch")},projectId:h})),r.a.createElement("div",{style:{marginTop:"3em"}},r.a.createElement(z,{imageList:p})))},N=a(206),q=a(454),M=a(462),F=a(102);function U(){return(U=Object(h.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.a.post("/api/add_project",t);case 2:a=e.sent,console.log(a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B=function(){var e=Object(n.useState)(!1),t=Object(f.a)(e,2),a=t[0],c=t[1],i=Object(N.a)(),o=i.register,u=i.errors,m=i.handleSubmit;return r.a.createElement(b.a,null,a&&r.a.createElement(l.a,{to:"/projects"}),r.a.createElement(A.a,{textAlign:"center",style:{height:"80vh"},verticalAlign:"middle"},r.a.createElement(A.a.Column,{style:{maxWidth:450}},r.a.createElement(q.a,{size:"large",onSubmit:m((function(e,t){(function(e){return U.apply(this,arguments)})(e).then((function(){c(!0),t.target.reset()}))}))},r.a.createElement(M.a,{stacked:!0},r.a.createElement(q.a.Field,null,r.a.createElement("input",{type:"hidden",name:"created_user",value:"web_user",ref:o}),r.a.createElement("input",{placeholder:"Project title",name:"title",ref:o({required:!0})}),u.title&&r.a.createElement(F.a,{pointing:!0,prompt:!0},"Project title is required")),r.a.createElement(q.a.Field,null,r.a.createElement("input",{placeholder:"Description",name:"description",ref:o({required:!0})}),u.description&&r.a.createElement(F.a,{pointing:!0,prompt:!0},"Project description is required")),r.a.createElement(s.a,{color:"teal",fluid:!0,size:"large"},"Add Project"))))))},G=a(217),H=a(31),J=function(e){var t=e.x,a=e.y,n=e.width,c=e.height,i=e.stroke,o=e.name;return r.a.createElement(H.Rect,{x:t,y:a,width:n,height:c,scaleX:1,scaleY:1,stroke:i,strokeWidth:2,name:o})},$=function(e){var t=e.x,a=e.y,c=e.width,i=e.height,o=e.name,l=e.stroke,u=e.onTransform,s=Object(n.useRef)();Object(n.useEffect)((function(){s.current.getLayer().batchDraw()}),[]);return r.a.createElement(H.Rect,{ref:s,x:t,y:a,width:c,height:i,scaleX:1,scaleY:1,stroke:l,strokeWidth:3,name:o,strokeScaleEnabled:!1,draggable:!0,onDragEnd:function(e){var t=e.target;u({x:t.x(),y:t.y()})},onTransformEnd:function(e){var t=e.target;t.setAttrs({width:t.width()*t.scaleX(),height:t.height()*t.scaleY(),scaleX:1,scaleY:1}),u({width:t.width(),height:t.height(),scaleX:t.scaleX(),scaleY:t.scaleY()})},onMouseEnter:function(e){var t=e.target;t.stroke("#ff4d4d"),t.getStage().container().style.cursor="move",s.current.getLayer().draw()},onMouseLeave:function(e){var t=e.target;t.stroke("#cc0000"),t.getStage().container().style.cursor="crosshair",s.current.getLayer().draw()}})};var K=function(e){var t=e.selectedShapeName,a=Object(n.useRef)();return Object(n.useEffect)((function(){var e=a.current.getStage().findOne(".".concat(t));e!==a.current.node()&&(e?a.current.attachTo(e):a.current.detach(),a.current.getLayer().batchDraw())}),[t]),r.a.createElement(H.Transformer,{ref:a,ignoreStroke:!0,rotateEnabled:!1})},Q=a(218),V=a.n(Q);a(219);function Z(){return(Z=Object(h.a)(d.a.mark((function e(t,a){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.a.post("/api/get_predictions_by_image_url",{image_url:t,image_key:a});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(){return(ee=Object(h.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.a.post("/api/get_project_by_id",{project_id:t});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var te=function(e){var t=e.match,a=Object(n.useState)({}),c=Object(f.a)(a,2),i=(c[0],c[1]),o=Object(n.useState)([]),l=Object(f.a)(o,2),u=l[0],m=l[1],p=Object(n.useState)([]),d=Object(f.a)(p,2),h=d[0],g=d[1],E=Object(n.useState)(!1),j=Object(f.a)(E,2),y=j[0],v=j[1],O=Object(n.useState)(!1),w=Object(f.a)(O,2),x=w[0],S=w[1],_=Object(n.useState)(0),L=Object(f.a)(_,2),P=L[0],T=L[1],D=Object(n.useState)({w:0,h:0}),R=Object(f.a)(D,2),C=R[0],A=R[1],I=Object(n.useState)(0),z=Object(f.a)(I,2),W=z[0],X=z[1],Y=Object(n.useState)([]),N=Object(f.a)(Y,2),q=N[0],M=N[1],F=Object(n.useState)(0),U=Object(f.a)(F,2),B=U[0],Q=U[1],te=Object(n.useRef)([]),ae=Object(n.useState)(""),ne=Object(f.a)(ae,2),re=ne[0],ce=ne[1],ie=Object(n.useState)(!1),oe=Object(f.a)(ie,2),le=oe[0],ue=oe[1],se=Object(n.useRef)([]),me=t.params.pid;function pe(e,t){S(!0),function(e,t){return Z.apply(this,arguments)}(e,t).then((function(e){if(e.success){g(e.data.predictions),S(!1);var t=e.data.image_size;A({w:t[0],h:t[1]})}}))}var de=function(e){if("Stage"===e.target.getType())return ue(!0),void ce("");if(!("Transformer"===e.target.getParent().className)){var t=e.target.name(),a=q.find((function(e){return e.name===t}));ce(a?t:"")}},fe=function(){ue(!1)};return Object(n.useEffect)((function(){(function(e){return ee.apply(this,arguments)})(me).then((function(e){i(e.data),se.current=[],e.image_data.map((function(e,t){m((function(t){return[].concat(Object(k.a)(t),[{id:e.id,key:e.key,image_url:e.image_url}])})),se.current[t]=Object(n.createRef)()})),v(!0)}))}),[]),r.a.createElement(b.a,null,r.a.createElement("div",null,y&&u.map((function(e,t){return r.a.createElement("img",{key:t,style:{display:"none"},src:e.image_url,ref:se.current[t],onLoad:function(){X(W+1)}})}))),r.a.createElement("div",null,y&&u.map((function(e,t){return r.a.createElement(s.a,{key:t,circular:!0,size:"tiny",onClick:function(){return function(e){T(e),g([]),M([])}(t)},content:t})}))),y&&W==u.length&&r.a.createElement("div",null,r.a.createElement("div",{style:{float:"left",display:"block"}},r.a.createElement(H.Stage,{style:{float:"left"},width:se.current[P].current.width,height:se.current[P].current.height,onMouseDown:de,onTouchStart:de,onMouseUp:le&&fe,onTouchEnd:le&&fe},r.a.createElement(H.Layer,null,r.a.createElement(H.Image,{image:se.current[P].current})),r.a.createElement(H.Layer,null,!x&&h.map((function(e,t){return r.a.createElement(H.Group,{key:t},r.a.createElement(J,{x:e.box[1]*C.w,y:e.box[0]*C.h,width:(e.box[3]-e.box[1])*C.w,height:(e.box[2]-e.box[0])*C.h,stroke:"#33d6ff",strokeWidth:2,name:e.label+"-"+t}),r.a.createElement(H.Text,{x:e.box[1]*C.w,y:e.box[0]*C.h,fill:"#ccf5ff",fontSize:20,text:e.label}))}))),r.a.createElement(H.Layer,null,q.map((function(e,t){return r.a.createElement($,Object.assign({ref:te.current[t].current,sclassName:"rect",key:e.key},e,{onTransform:function(e){!function(e,t){q[e]=Object(G.a)({},q[e],{},t),M((function(e){return Object(k.a)(e)}))}(t,e)}}))})),r.a.createElement(K,{selectedShapeName:re})))),r.a.createElement("div",{style:{float:"left",marginLeft:"10px",display:"block"}},r.a.createElement(s.a,{onClick:function(e){e.preventDefault(),pe(u[P].image_url,u[P].key)}},"Predict"),!x&&h.map((function(e,t){return r.a.createElement("div",{key:t},e.label)}))),r.a.createElement("div",{style:{float:"left",marginLeft:"10px",display:"block"}},r.a.createElement(s.a,{onClick:function(e){e.preventDefault(),te.current[B]=Object(n.createRef)(),M((function(e){return[].concat(Object(k.a)(e),[{x:10,y:10,width:100,height:100,name:"rect".concat(B+1),stroke:"#cc0000",key:V.a.generate(),ref:te.current[B].current}])})),Q(B+1)}},"Add"))))},ae=Object(m.a)(),ne=r.a.createElement(o.a,{history:ae},r.a.createElement(u.a,null,r.a.createElement(u.a.Item,null,r.a.createElement(o.b,{to:"/"},"Home")),r.a.createElement(u.a.Item,{position:"right"},r.a.createElement(s.a,{color:"teal",as:o.b,to:"/addProject"},"Add Project"))),r.a.createElement(l.d,null,r.a.createElement(l.b,{exact:!0,path:"/",component:v}),r.a.createElement(l.b,{path:"/projects",component:v}),r.a.createElement(l.b,{path:"/project/:pid",component:Y}),r.a.createElement(l.b,{path:"/annotate/:pid",component:te}),r.a.createElement(l.b,{path:"/addProject",component:B})));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement("div",null,ne),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[233,1,2]]]);
//# sourceMappingURL=main.22a2a341.chunk.js.map